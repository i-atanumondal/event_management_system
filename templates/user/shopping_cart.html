<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Cart</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<style>
    .right-align-button {
        display: inline-block;
        float: right;
    }

    .top-buttons {
        margin-bottom: 20px;
    }
</style>
<body>
    <div class="top-buttons">
        <a href="/user/dashboard" class="btn btn-primary">Home</a>
        <a href="/user/view-products" class="btn btn-primary">View Products</a>
        <a href="/user/request-item" class="btn btn-primary">Request Item</a>
        <a href="/user/product-status" class="btn btn-primary">Product Status</a>
        <a href="/user/logout" class="btn btn-danger" style="float: right;">Logout</a>
    </div>

    <h2>Shopping Cart</h2>

    <table class="table">
        <thead>
            <tr>
                <th>Name</th>
                <th>Price</th>
                <th>Quantity</th>
                <th>Total Price</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
            {% for item in cart_items %}
                <tr>
                    <td>{{ item[1] }}</td>
                    <td>${{ item[2] }}</td>
                    <td>
                        <select class="quantity-dropdown" data-product-id="{{ item.product_id }}">
                            <option value="1" selected>1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                        </select>
                    </td>
                    <td>${{ item[4] }}</td>
                    <td>
                        <a href="/remove-from-cart/{{ item[0] }}" class="btn btn-danger">Remove</a>
                    </td>
                </tr>
            {% endfor %}
        </tbody>
    </table>

    <p id="grand-total" style="display: inline-block; margin-right: 10px;">Grand Total: ${{ total_price }}</p>
    <div class="right-align-button">
        <form action="/user/cart/delete-all" method="post">
            <button type="submit" class="btn btn-danger">Delete All</button>
        </form>
    </div>

    <a href="/user/cart/checkout" class="btn btn-success">Proceed to Checkout</a>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(document).ready(function() {
            $(".quantity-dropdown").change(function() {
                var grandTotal = 0;
                $("table tbody tr").each(function() {
                    var $row = $(this);
                    var price = parseFloat($row.find("td:eq(1)").text().replace('$', ''));
                    var quantity = parseInt($row.find(".quantity-dropdown").val());
                    var total_price = price * quantity;

                    $row.find("td:eq(3)").text("$" + total_price.toFixed(2));

                    grandTotal += total_price;
                });

                $("p#grand-total").text("Grand Total: $" + grandTotal.toFixed(2));
            });
        });
    </script>
</body>
</html>
